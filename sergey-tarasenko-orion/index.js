import p5 from"p5";import{FXInit,FXRandomIntBetween,FXRandomOption,FXRandomBool,FXRandomBetween}from"@liamegan1/fxhash-helpers";const FXR=require("fxrandomjs"),rnd=new FXR(fxhash,!0);FXInit(rnd.fxrand);const seed=~~(123456789*fxrand()),sketch=e=>{const n=(e,n)=>FXRandomIntBetween(e,n),o=e=>FXRandomOption(e),t=(e=>{let t=[5,5,o([[1,1,2,2],[2,2,2,2]]),o([1,2])];return e<.3?t=[10,10,o([[2,2,2,2]]),n(1,2)]:e<.5?t=[1,1,o([[1,1,2,2]]),1.1]:e<.6?t=[1,2,o([[1,1,2,2],[1,2,2,2],[1,2,2,1]]),1.5]:e<.7&&(t=[3,1,o([[1,1,1,1]]),2]),t})(FXRandomBetween(0,1)),a=o([["#2c698d","#e3f6f5"],["#64379f","#fff29c"],["#3e4491","#E6C6AE"],["#463f3a","#fcbf49"],["#B8413C","#ffffff"],["#362430","#EC8353"],["#2E5247","#F0C415"],["#603952","#F9F9F8"],["#5a2df8","#f8fafb"],["#003049","#fcbf49"],["#001d3d","#ffc300"],["#2f3e46","#d9ed92"]]),r=(e,n)=>e.levels[n].toFixed(1),i=n(300,600),l=e.color(0),s=e.color(a[0]),c=e.color(a[1]),f=e.color(a[1]),d=[],p=[],m=[],h=[],v={};let x,u,F,w,S,y,C,g=!1;const I=()=>n(-w,w)/F,X=(n,o,a,r)=>{let i=e.sin(n*t[0]),l=e.cos(n*t[1]),s=t[2];return[i*(r||1==s[0]?o:a),l*(r||1==s[1]?o:a),i*(r?a:1==s[2]?o:a),l*(r?a:1==s[3]?o:a)]},R=()=>{u=e.min(e.windowHeight,e.windowWidth),x=u/2,F=u/1e3,w=-x,C=e.round(u/F)},$=()=>{S=u/8/2-17*F;let n=0,o=n+S/t[3];for(let t=0;t<8;t++){if(0!=t){let a=[],r=d[t]==e.LINES;if(h[t])for(let i=0,l=2*e.PI,s=e.PI/p[t];i<l;i+=s)a.push(X(i,n,o,r));else for(let i=2*e.PI,l=0,s=e.PI/p[t];i>l;i-=s)a.push(X(i,n,o,r));v[t]=a}n+=S,o+=S}};e.setup=()=>{R(),e.noLoop(),e.createCanvas(u,u,e.WEBGL),e.smooth(),(()=>{for(let n=0;n<8;n++)d[n]=o([e.LINES,e.TRIANGLES,e.QUADS]),p[n]=o([9,12,18,21,24,27]),h[n]=FXRandomBool(.5);for(let e=0;e<i;e++)m[e]=[I(),I(),n(1,5)]})(),(()=>{let o=r(l,0),t=r(l,1),a=r(l,2),i=r(s,0),c=r(s,1),f=r(s,2),d=`\n  precision mediump float;\n  varying vec2 vTexCrd;\n  uniform float noiseSeed;\n  uniform vec2 crds;\n  float hash12(vec2 p){\n    vec3 p3  = fract(vec3(p.xyx) * .1031 * noiseSeed);\n    p3 += dot(p3, p3.yzx + 33.33);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n  float map(float value, float min1, float max1, float min2, float max2) {\n    return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n  }\n  float noise(vec2 p){\n    vec2 ip = floor(p);\n    vec2 u = fract(p);\n    u = u*u*(3.0-2.0*u);\n    float res = mix(mix(hash12(ip),hash12(ip+vec2(1.0,.0)),u.x),mix(hash12(ip+vec2(.0,1.0)),hash12(ip+vec2(1.0,1.0)),u.x),u.y);\n    return res*res;\n  }\n  void main() {\n    vec2 crd = vTexCrd;\n    crd += crds;\n    float a = .6*noise(crd*2.0)+.1*noise(crd*4.0)+.17*noise(crd*6.0)+.1*noise(crd*7.0)+.02*noise(crd*200.0)+.01*noise(crd*100.0);\n    vec3 col = vec3(.0, .0, .0);\n    if(a<0.25) {\n      col.x = map(a, .0, .25, ${o}, ${i});\n      col.y = map(a, .0, .25, ${t}, ${c});\n      col.z = map(a, .0, .25, ${a}, ${f});\n    } else {\n      col.x = map(a, .25, .5, ${i}, ${o});\n      col.y = map(a, .25, .5, ${c}, ${t});\n     \tcol.z = map(a, .25, .5, ${f}, ${a});\n    }\n    col /= 255.0;\n    gl_FragColor = vec4(col, 1.0);\n  }\n    `;y=e.createGraphics(u,u,e.WEBGL);let p=y.createShader("\n\t\tattribute vec3 aPosition;\n\t\tattribute vec2 aTexCoord;\n\t\tvarying vec2 vTexCrd;\n\t\tvoid main() {\n\t\t\tvTexCrd = aTexCoord;\n\t\t\tvec4 posV4 = vec4(aPosition, 1.0);\n\t\t\tposV4.xy = posV4.xy * 2.0 - 1.0;\n\t\t\tgl_Position = posV4;\n\t\t}\n\t",d);y.shader(p),p.setUniform("noiseSeed",n(1e3,2e3)),y.rect(0,0,u,u)})(),$()},e.draw=()=>{e.resizeCanvas(u,u,!0),e.randomSeed(seed),e.noiseSeed(seed),rnd.setSeed(fxhash,!0),FXInit(rnd.fxrand),e.pixelDensity(1*e.displayDensity()),e.push(),e.translate(0,0,-1*F),e.image(y,w,w,u,u),e.pop(),(()=>{e.color(f).setAlpha(220);for(let n of m){let o=n[0]*F,t=n[1]*F,a=n[2]*F;e.push(),e.noStroke(),e.fill(f),e.translate(0,0,-1*F),e.ellipse(o,t,a,a),e.pop()}})(),(()=>{let n=40*F,o=w+n,t=x-n,a=u-2*n,r=3*F;e.push(),e.noStroke(),e.fill(c),e.rect(o,o,a,r),e.rect(o,t,a,-r),e.rect(o,o,r,a),e.rect(t,o,-r,a),e.pop()})(),(()=>{for(let n=0;n<8;n++){if(e.push(),0==n)e.fill(c),e.noStroke(),e.circle(0,0,S);else{e.strokeWeight(2*F),e.fill(0,0,0,0),e.stroke(c),e.translate(0,0,-1*F),e.beginShape(d[n]);for(let o of v[n])e.vertex(o[0],o[1]),e.vertex(o[2],o[3]);e.endShape()}e.pop()}})(),(()=>{let n=e.createImage(C,C);n.loadPixels();for(let o=0;o<n.width;o++)for(let t=0;t<n.height;t++){let a=255*(.3*e.randomGaussian()+.8);n.set(o,t,e.color(a,a,a,30))}n.updatePixels(),e.image(n,w,w,u,u)})(),g||(fxpreview(),g=!0)},e.windowResized=()=>{R(),$(),e.resizeCanvas(u,u)}};new p5(sketch,window.document.body);